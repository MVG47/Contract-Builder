<html>
	<head>
		<!-- Load jQuery, Vue and Sheetrock from CDNJS -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.4.2/vue.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-sheetrock/1.1.4/dist/sheetrock.min.js"></script>
	</head>
	<body>
		<table id="statistics" class="table table-condensed table-striped"></table>
	</body>
	<footer>
		<script>
			// globals
			var docObject = [];
			var collection;
			var myCallback = function (error, options, response) {
				if (!error) {
					//console.log(response.rows);
					// making sure it will work even if order changes
					var idIndex = response.rows[0].labels.indexOf('id');
					var descriptionIndex = response.rows[0].labels.indexOf('description');
					var contentIndex = response.rows[0].labels.indexOf('content');
					var typeIndex = response.rows[0].labels.indexOf('type');
					var dependsIndex = response.rows[0].labels.indexOf('depends');
					var mandatoryIndex = response.rows[0].labels.indexOf('mandatory');

					var collection = response.rows.slice(1, response.rows.length); // remove labels
					var collNoDependency = collection.filter(function(item){ // get all objects that has no dependency
						return (item.cellsArray[dependsIndex] === '');
					});
					$(collNoDependency).each(function(){
						var tempObject = Object();
						tempObject.id = this.cellsArray[idIndex];
						tempObject.description = this.cellsArray[descriptionIndex];
						tempObject.content = this.cellsArray[contentIndex];
						tempObject.type = this.cellsArray[typeIndex];
						tempObject.depends = this.cellsArray[dependsIndex];
						tempObject.mandatory = this.cellsArray[mandatoryIndex];
						tempObject.childs = [];

						docObject.push(tempObject);
					});
					var collDependency = collection.filter(function(item){ // get all objects that has dependency
						return (item.cellsArray[dependsIndex] !== '');
					});
					$(collDependency).each(function(){
						var tempObject = Object();
						tempObject.id = this.cellsArray[idIndex];
						tempObject.description = this.cellsArray[descriptionIndex];
						tempObject.content = this.cellsArray[contentIndex];
						tempObject.type = this.cellsArray[typeIndex];
						tempObject.depends = this.cellsArray[dependsIndex];
						tempObject.mandatory = this.cellsArray[mandatoryIndex];
						tempObject.childs = [];

						docObject.filter(function(item){ // get all objects that has dependency
							if (item.id === tempObject.depends)
								item.childs.push(tempObject);
						});
					});

					debugger;
					localStorage.setItem('testObject', JSON.stringify(docObject));
				}
			};
			sheetrock({
				url: "https://docs.google.com/spreadsheets/d/1HFGm_cSH_XeZtxfREusftu-4S1LYZeAVSVjWMmsRHtY/edit#gid=0",
				callback: myCallback
			});
		</script>
	</footer>
</html>